---
title: "[통신 및 네트워크] 인터넷 프로토콜(IP)"
date: 2023-11-27 12:57:47 +0900
categories: [Study, Data Communication Network]
tags: [network]
---

> 데이터통신과 네트워킹, 조성호 저, 인피니티북스
> 
> > Chapter 11. 인터넷 프로토콜(IP)

<br>

## **인터넷 프로토콜(IP)의 작업**

### **네트워크 계층과 IP의 이해**

네트워크 계층의 주요 작업은 라우팅이며, 네트워크 계층을 대표하는 프로토콜이 IP이다. IP는 IP 주소 체계와 도메인 주소를 관리하고, IP - MAC 주소 변환을 수행하며, 네트워크를 여러 개의 서브넷으로 분할하고 다른 기종의 LAN을 연결하는 역할을 한다.

<br>

### **서비스 요구사항(Quality of Services, QoS)**

네트워크 요구사항에는 다음 네 가지가 있다.

- 신뢰성

- 지연

- 지터

- 대역폭

각 응용 프로그램마다 요구사항이 다르다. 예를 들어 이메일 서비스는 높은 신뢰성을 필요로 하는 대신 지연/지터/대역폭은 낮아도 상관 없고, 화상회의 서비스는 지연, 지터, 대역폭 모두 높아야 하지만 몇몇 패킷이 소실되어도(신뢰성이 낮아도) 된다.

<br>

### **혼잡 제어(Congestion Control)**

혼잡이 발생하는 곳의 흐름을 변화시켜 혼잡을 완화시키는 작업이다. 아래의 동작들을 통해 수행할 수 있다.

- 타임아웃 시간 늘리기

- 패킷을 천천히 전송하여 슬라이딩 윈도우 크기 줄이기

- 패킷과 패킷 간 전송 간격 조정하기

윈도우 크기를 줄일 때 사용하는 패킷을 **초크 패킷**이라고 한다. 즉 윈도우 크기를 줄이자는 의미로 상대방 호스트에게 보내는 빈 패킷이 초크 패킷이고, 초크 패킷을 받은 호스트는 윈도우 크기를 줄인다. IP 헤더에서 초크 패킷의 역할을 하는 필드가 **ECN**(Explicit Congestion Notification)이다.

또한, 패킷의 흐름을 일정 간격으로 조절하면 혼잡이 완화되는 효과가 있다. 이와 관련된 버퍼를 이용한 혼잡 제어 알고리즘으로 **토큰 버킷 알고리즘**이 있으며, 일정하지 않은 간격으로 도착하는 패킷을 버킷에 넣고, 간격을 맞추어 천천히 패킷을 처리하는 방식이다. 

<br>

### **패킷 단편화**

LAN마다 패킷의 처리 능력이 다를 뿐만 아니라 다룰 수 있는 패킷의 크기도 상이하기 때문에, 처음 보낸 패킷이 여러 조각으로 배달되는 경우가 흔하게 발생한다. LAN이 끝나는 지점에서 원래의 패킷으로 합쳐서 보내주면 문제가 없지만, 작은 패킷으로 분리된 채로 목적지에 도착할 수도 있기 때문에 IP에서는 원본을 확인할 수 있도록 장치를 심어두고 있다.

패킷의 맨 앞 3개 필드는 패킷 분할과 관련하여 헤더에 있는 값이다. 첫 번째는 Identification Number 필드로, 잘려나간 패킷이 여러 개인 경우 같은 패킷이 있는 데이터인지 확인한다. 두 번째는 Fragment Offset 필드이다. 오프셋이 기준 위치로부터 패킷이 얼만큼 떨어져 있는지 나타내기 때문에, 해당 필드는 분할되기 전 패킷 데이터로부터 얼만큼 떨어진 위치에 있는 데이터인지를 알려준다. 세 번째 More Fragment 필드는 1이면 맨 마지막 패킷, 0이면 분할되어 뒤따르는 패킷이 더 있다는 의미이다.

- 2개로 분할된 경우
  
  (image)
  
  ID Number 필드가 21으로, 두 개의 패킷이 하나의 패킷에서 분할되었음. Fragment Offset은 0이기 때문에 원래 데이터의 0번째 위치라는 뜻. 분할된 두 개의 패킷 중 뒤의 패킷의 7은 원래 데이터의 7번째 위치에 있었다(7만큼 떨어져 있다)는 것을 의미하고, More Fragment 필드의 1이 패킷의 끝을 알려줌.

- 3개로 분할되고 순서가 바뀌어 도착한 경우
  
  (image)
  
  가장 앞에 있는 패킷은 Fragment Offset 필드가 0이므로 맨 앞 패킷이고, Fragment Offset이 7이고 More Fragment 필드가 1인 것이 원본의 마지막 패킷이다. 받는 쪽에서는 패킷이 3개로 분할되었는지 혹은 그 이상으로 분할되었는지 알지 못하며, 중간 패킷의 More Fragment 1을 보고 더 이상 분할된 패킷이 없다는 사실만 알 수 있다.
  
  <br>
  
  ### **터널링**
  
  무선 전화통신망은 IP 패킷과는 다른 종류의 헤더를 사용하기 때문에 패킷이 인터넷 망이 아닌 구간을 지날 때 어떻게 해야 하는가의 문제가 발생하게 된다. 이때 기존의 IP 패킷을 무선 전화망에서 사용하는 패킷에 집어넣고 무선 전화망과 인터넷이 연결되는 곳까지 보낸 후, IP 패킷으로 전송한다. 이것을 터널링 혹은 IP 터널링이라고 한다.
  
  <br>
  
  <br>
  
  ## **IP 헤더 분석**
  
  ### **IPv4 헤더**
  
  32비트를 기준으로 나눈다. 1 - 5줄은 필수고, 나머지는 옵션이다. 필수 부분은 20(=5 * 4)바이트이다.
  
  (image)
  
  IPv6 헤더는 아래와 같이 구성된다. 크기는 40바이트로 고정되어 있으며, 옵션 부분이 없다.
  
  (image)
  
  IPv6의 경우 128비트의 주소를 10진수로 표현하면 길이가 매우 길어진다는 문제가 있다. 따라서 4개 16진수를 하나로 묶어서 8개의 덩어리로 표시하며, 각 덩어리를 콜론(:)으로 구분한다. 이때 주소의 중간에 0이 많이 나타나게 되는데 이 경우 생략이 가능하다.
  
  <br>
